\chapter{Evaluation} \label{chap:evaluation}
After explaining the solution's implementation, this chapter presents the evaluation's results. The evaluation is based on the metrics introduced in section~\ref{sec:fund_loc}.

\section{Accuracy and Precision}
To determine the solution's accuracy and its precision, different tests in a real world experiment where done. Therefor, the 10 beacons, bought from BEACONinside, where deployed in parts of the university's building. The tests where done in a static environment; thus, the test person was the only dynamic subject in the experiment. Besides the deployed beacons, the building is equipped with several WiFi access points, which use the 2.4GHz baseband too. Thus, their signals may influence the bacons' signals. During the experiments, a static particle set size of 200~particles was used, as mentioned in chapter~\ref{chap:pf}.

\subsection*{Experiment~1}
For the first experiment only one lecture hall was equipped with all 10 beacons. Figure~\ref{fig:f007} shows a picture of the lecture hall, to give a better insight. On the following screenshots, the lecture hall is depicted on the map's lower part. The picture was taken from the hall's lower left corner.

\begin{figure}
	\includegraphics[width=0.9\textwidth]{figures/F007}
	\caption{Shows the lecture hall depicted on the map's lower part.}
	\label{fig:f007}
\end{figure}

\begin{figure}
	\input{figures/evaluationExperiment1}
	\caption{The Screenshots illustrate results of Experiment~1.}
	\label{fig:exp1_screenshot}
\end{figure}

The purpose of this experiment is to test how good the localization works inside the shown lecture hall. The lecture hall, depicted in the lower part of figure~\ref{fig:exp1_path}, is  $\approx$~15m long and 8~-â€“~11m wide. The beacons' positions are depicted as blue circles.

To determine the algorithms accuracy, the test person walked on a specified path, depicted in green, beginning and ending at the upper left corner. At the end of each walk the application's estimated end position was compared with the true end position, by calculating the error, in form of the euclidian distance. As mentioned in section~\ref{sec:algo_locEstimation}, the location can be estimated by either calculating the mean of $\chi$, or by calculating its weighted mean. To be able to compare them, the error of both approaches was calculated.

Additionally, the error of the motion tracking's end position was compared with the true position. To be able to compare the motion's error with the application's error, by taking the motions drift into account, the experiment was split up into three scenarios. First, the test person walked just one round on the green path. Second, two rounds and third, three rounds. For each scenario the test user did three walks in clockwise and three in counter-clockwise direction on the path.

Furthermore, this experiment was used to find out if the accuracy improves after being stationary for a short time at the end position. Thus, two location errors where determined. The error of the estimated position directly after integrating the last reported motion, and the location's error $\approx$~5s later.


\begin{table}
	\input{tables/evaluationResultExperiment1}
	\caption{Depicts the results of experiment~1.}
	\label{tab:evaluationResultExp1}
\end{table}

\begin{figure}
	\input{figures/evaluationExperiment1_Visualization}
	\caption{Visualizes the results shown in table~\ref{tab:evaluationResultExp1}.}
	\label{fig:exp1_visualization}
\end{figure}

\subsubsection*{Result}
The experiment's results are shown in table~\ref{tab:evaluationResultExp1} and are visualized in figure~\ref{fig:exp1_visualization}.

Table~\ref{tab:evaluationResultExp1_1} depicts the average distance error and the error's spreading, for each scenario, directly after integrating the last motion. Whereas, table~\ref{tab:evaluationResultExp1_2} shows the determined values recorded $\approx$~5s after the last motion integration. The calculated average error by using $\chi$'s mean as location, is denoted with $\mu$. The errors standard deviation is denoted with $\sigma$. $\mu_w$ and $\sigma_w$, are the average error and its standard deviation by using the weighted mean of $\chi$ for the position estimation.
Table~\ref{tab:evaluationResultExp1_3} shows the motion tracking's error $\mu$ and the errors spreading, in form of its standard deviation $\sigma$.

The results show, that during the experiment an accuracy of 2.29m~--~2.6m was achieved. It also shows, that the location estimation, tends to improves after being stationary at the end position, as expected.

The difference of the two position estimation approaches, is very small. The result sways, sometimes $\chi$'s mean, and sometimes its weighted mean is more accurate. Supposably the minimal difference is based on the particle cloud's high concentration.

The result's visualization also clearly states, that the motion's error grows with increasing rounds; whereas, the estimated pose error just grows minimal. Supposably, the minimal grow is the result of a few outlaws in the motion error, which of course infects the position estimation. Besides the path, figure~\ref{fig:exp1_screenshot} depicts three examples of the experiment. They clearly show, that the motions' accuracy influences the position estimation. If the motion is completely wrong (fig.\ \ref{fig:exp1_img_3}), the in section~\ref{sec:algo_stationary} introduced recovery feature, often needs to intervene, which causes several jumps in the position estimation. Whereas, figure~\ref{fig:exp1_img_2} shows, that if the motion is acceptably wrong, the algorithm can correct the path (of course not perfectly). If the motion estimation fits the true path, the estimated path depends just on the beacons' signal quality, as shown in figure~\ref{fig:exp1_img_1}.

\subsection*{Experiment~2}
The purpose of the second experiment is on one hand, to double check the implementation's accuracy by using another position, and on the other hand, to demonstrate the dependency of the estimation's accuracy and the amount of deployed beacons.

This time, the test person walked on a random path. The person started at the orange circle, shown in figure~\ref{fig:exp2_imgs} on the upper left corner, and stopped at the green circle, approximately in the figure's center.

To demonstrate the reduction of the deployed beacon, five test walks with 10 beacons deployed where recorded. Then the simulation was used, to play back the recorded values by reducing the deployed beacons. Thus, the values are directly comparable, because for all test cases the exact same input data was used. Also for this experiment the location error directly after integrating the last motion and $\approx$~5s later where calculated.

\subsubsection*{Result}
The experiment's results are shown in table~\ref{tab:evaluationResultExp2} and visualized in figure~\ref{fig:exp2_visualization}. The corresponding beacon deployment, is shown in figure~\ref{fig:exp2_imgs}.

First of all, the result clearly approves, that the difference between $\chi$'s mean and its weighted mean, is negligible.

Secondly, it clearly shows, that the estimated location compared to the motion is more accurate. Additionally, it depicts that the location estimation drastically improves after being seconds stationary, for $\approx$~5s.

The result also approves, that the estimation's accuracy depends on the deployed beacons. Thus, the more beacons the less error in the position estimation. But it also shows, that at a certain beacon density the error's reduction converges. Furthermore, deploying more beacons does not always improves accuracy. This seems to be the case in the experiment by reducing the beacon amount from four to two deployed beacons. Supposably, the signal's of the two removed beacons were too bad, and thus produced a worse estimation result.

\begin{table}
	\input{tables/evaluationResultExperiment2}
	\caption{Depicts the results of experiment~2.}
	\label{tab:evaluationResultExp2}
\end{table}

\begin{figure}
	\input{figures/evaluationExperiment2_Visualization}
	\caption{Visualizes the results shown in table~\ref{tab:evaluationResultExp2}.}
	\label{fig:exp2_visualization}
\end{figure}


\begin{figure}
	\input{figures/evaluationExperiment2}
	\caption{Shows the different beacon deployments during the experiment.}
	\label{fig:exp2_imgs}
\end{figure}


\subsection*{Experiment~3}
After evaluating the solution's accuracy in the first two experiments, this experiment shows how good the solution is able to track an users path in a larger scenario. Therefor, we additionally used the buildings foyer, depicted in figure~\ref{fig:f-foyer}, and one / two additional lecture halls. For the experiments, only 10 beacons where used, as shown on the maps. The map depicts an actual space of $\approx$~22.22m~$\times$~33.06m.

The first example is depicted in figure~\ref{fig:exp3_imgs}. The green line illustrates approximately the actual path, beginning at the top right. The black dashed line shows the motion path; which is just the combination of pedometer and heading. The estimated path is marked as blue dashed path. Figure~\ref{fig:exp3_imgs_1} shows, an example where the motion was very accurate, actually more accurate than the estimated path. Whereas, figure~\ref{fig:exp3_imgs_2}, \ref{fig:exp3_imgs_3}, and~\ref{fig:exp3_imgs_4} depict examples, where the motion path is bad or completely wrong, but the algorithm was more or less able to approximate the actual path.

Figure~\ref{fig:exp3_imgs_5} depicts another example, where the test person walked around the big stairs in the middle of the building's foyer. The screenshot shows, that the algorithm also was able to approximate this path. During this example the foyer was equipped only with 4 beacons, as shown on the map. But, the experiment also showed, that 4 beacons are to less for such a large area, if the motion is incorrect.

Another example path is shown in figure~\ref{fig:exp3_imgs_6}. During this example the wall between the two upper halls was opened. As shown, the algorithm was able to track the path. But usually this would also not be possible without having such an accurate motion, by using just 10 beacons. Furthermore, the screenshot shows, that the estimated end pose is actually not at the true position, but rather $\approx$~4~--~5m too distant. But the screenshot also shows, that two particles are located next to the true position, and that the plotted $\sigma-\text{ellipse}$ is oriented towards these two particles. The reason for that is, that the algorithms weight sum dropped below the recover's threshold, and thus the recovery was executed. Unfortunately, the data recording was stopped at this point in time, otherwise its very likely that the particle cloud would jump to the true location, where the two particles are already located. 


\begin{figure}
	\includegraphics[width=0.9\textwidth]{figures/F-Foyer}
	\caption{Shows the buildings Foyer depicted on the map's middle.}
	\label{fig:f-foyer}
\end{figure}

\begin{figure}
	\input{figures/evaluationExperiment3_1}
	\caption{Shows the different beacon deployments during the experiment.}
	\label{fig:exp3_imgs}
\end{figure}

\begin{figure}
	\input{figures/evaluationExperiment3_2}
	\caption{Shows the different beacon deployments during the experiment.}
\end{figure}


\subsection*{Summary}
The algorithm was tested in a typical environment, with enabled WiFi, obstacles and lots of reflecting material, as shown on the building's images.

The experiments approve, that the estimation's accuracy depends on the amount of deployed beacons, but also on their position and attitude relative to the user, which influences the beacons' signals. Furthermore, the experiments showed, that the estimated position not only depends on the beacons' signals. It also depends on the motion's quality. As shown by experiment~3, location estimation is possible with having too less beacons deployed, but for that the motion must be relatively correct. Besides that it also proofs, that if enough beacons are deployed, the solution is able to correct the path, on the basis of the beacon's signals.

Furthermore the experiment's results depict, that the location estimation improves after being stationary for a few seconds, if enough beacons are deployed.

Due to the fact that the application's accuracy and precision depends on so many different factors, it is just possible to point out, what the system reached during the experiments. But it is not possible to make a generally valid statement about the system's precision and accuracy. During the experiments it reached an accuracy up to 1.52m (experiment 2). By combining the results of experiment 1 and 2 (with 10 beacons), the system reached an accuracy of 2.12m ($\mu=2.12$, $\sigma=2.72$). The solution's precision, expressed as commutative distribution function (CDF), is shown in figure~\ref{fig:eval:precision}.

To summarize, the solution provides at least room level or even better accuracy, depending on the deployed beacon count and other parameters. Furthermore, the solution is able to track a user's path in environments with lots of free space, as shown by the experiments. Consequently, the system's ability to track a user's path in a corridor should be very good, due to the fact that it takes the map's free space into account. The solution's only disadvantage is, that the user has to hold the device in hand by pointing into the user's walking direction. Otherwise the motion's orientation is completely wrong, and thus recovery often needs to be executed.

\pgfmathdeclarefunction{cdf}{2}{%
  \pgfmathparse{1/(1 + exp(-0.07056*((x-#1)/#2)^3 - 1.5976*(x-#1)/#2))}%
}

\begin{figure}
	\input{figures/evaluationPrecision}
	\caption{Depicts our solutions precision during the experiments.}
	\label{fig:eval:precision}
\end{figure}


% depends on the beacons position
% on the location in the room
% on the building
% on the beacons itself
% -> on beacons signals, and motion quality

\section{Scalability}
The area covered from the localization system, depends only on the provided map and the deployed beacons. Thus, the system is highly scalable. It can be used within a single room. But it also can be extended to a very large, two-dimensional space.

\section{Robustness}
The system is very robust. It can deal with wrong and missing beacon signals, which is a very common problem. Furthermore, it is able to deal with wrong motion data, caused by influenced heading or wrong distance estimations provided by the pedometer, as shown by the experiments.

Due to the implemented recovery from failure state, it is also able to detect completely wrong position estimations. The only requirement for the recovery is, that the application needs to at least receive the signal of one beacon.

\section{Complexity}
The solution's complexity is relatively low. Besides the beacons and a typical smartphone, no additional infrastructure, such as a network connection or external power supply, is required.
	
Also, the software complexity is relatively low, due to the used \ac{PF} algorithm. Of course, if a platform does not provide such high level \acs{API}'s, especially such as \acl{CM}'s pedometer, to estimate the walked distance, this low level of complexity would not be achieved.

\section{Cost}
Besides the beacons no additional infrastructure is required. Furthermore, the users can use their own smartphones. Thus, the building's owner just needs to deploy the beacons.

Consequently, the system's cost mainly depends on the to be covered area, and thus on the required amount of beacons and the initial deployment and setup costs. 100 beacons (incl.\ batteries) from BEACONinside do cost 1790EUR, but for sure also cheaper manufacturers do exist.

Furthermore, the system's maintenance effort is relatively low. Typically, the beacons' batterie lifetime is up to a year or more. And as long as no big changes to the beacons' environment are made, recalibration is not necessary.

\section{Usability}
The localization system is very easy to use. The user just has to download the App from the platform's app store. After launching and giving the application access to \acl{BT}, localization can start.

The user interface can be reduced to a minimum, by only showing the environments map, the estimated position and the corresponding $1\sigma-\text{ellipse}$, instead of showing the beacons, the motion path, the user's estimated path, and the particle cloud.

There is just one disadvantage from an usability point of view, which is the position estimation's delay. If the user walks, the estimated position is just being updated ever $\approx$~3s, due to the fact, that \acs{CM} just provides distance estimations every $\approx$~2.5s, as mentioned in chapter~\ref{chap:pf}. If the user is stationary, the delay drops to $\approx$~1s, which is negligible, from my point of view.
