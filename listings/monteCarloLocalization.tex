\begin{lstlisting}[
  float,
  floatplacement=H,
  mathescape,
  captionpos=b,
  caption=Basic \acl{MCL} algorithm based on \citet{thrun:prob_robo},
  label=lst:mcl]
mcl($\chi_{t-1}$, $u_t$, $z_t$, map) {

  $\bar{\chi}_t = \emptyset$
  for $m = 1$ to $M$ {
    $x^{[m]}_t$ = sample_motion_model($u_t$, $x^{[m]}_{t-1}$)
    $w^{[m]}_t$ = measurement_model($z_t$,$x^{[m]}_t$, map)
    add $\langle x^{[m]}_t, w^{[m]}_t \rangle$ to $\bar{\chi}_t$
  }


  \\ resampling
  $\chi_t = \emptyset$
  while size of $\chi_t$ less $M$ {
    draw $i$ with probability $\propto w^{[m]}_t$
    add $x^{[i]}_t$ to $\chi_t$
  }

  return $\chi_t$
}
\end{lstlisting}
